# 카카오페이 사전과제

## Subject

####특정 고객 거래내역 조회 서비스 개발

※ 고객을 타겟팅 하기 위한 지점 마케팅 API를 개발하려 합니다.

데이타에는 거래내역, 고객, 지점정보가 있습니다.   

각 데이타를 활용하여 아래 기능명세에 대한 API를 개발하고 각 기능별 Unit Test 코드를 개발하세요. 


## 기본 제약사항(필수)
*	API 기능명세에서 기술된 API를 모두 개발하세요.
*	Spring boot 기반의 프레임웍을 사용하세요.
*	단위 테스트(Unit Test) 코드를 개발하여 각 기능을 검증하세요.
*	모든 입/출력은 JSON 형태로 주고 받습니다.
*	단, 각 API에 HTTP Method들(GET|POST|PUT|DEL)은 자유롭게 선택하세요.
*	README.md 파일을 추가하여, 개발 프레임웍크, 문제해결 방법, 빌드 및 실행 방법을 기술하세요.


## 개발 환경
* intelliJ
* Spring Boot
* JAVA
* Mysql(Database) 8.0.17
* mybatis
* Maven
* Mockito

## 문제해결 방법
```
 API1. 2018년, 2019년 각 연도별 합계 금액이 가장 많은 고객을 추출하는 API 개발.
   (단, 취소여부가 ‘Y’ 거래는 취소된 거래임, 합계 금액은 거래금액에서 수수료를 차감한 금액임)

 ▶ Consideration
   - 거래내역 table과 계좌정보 table join 필요
   - 연도별, 계좌번호별 GROUP BY 필요
   - 합계 급액 = 거래금액 - 수수료
   - 취소여부가 'Y'인 거래는 취소된 거래로 유효하지 않으므로 취소여부가 'N'인 거래를 산출
   - 합계금액이 큰 순서로 SORT

```

```
 API2. 2018년 또는 2019년에 거래가 없는 고객을 추출하는 API 개발.
    (취소여부가 ‘Y’ 거래는 취소된 거래임)

 ▶ Consideration
   - 거래내역 table과 계좌정보 table join 필요
   - 취소된 거래는 거래로 보지 않는다. => 취소여부가 'Y'인 거래
   - 계좌정보에서 NOT EXISTS를 활용해 거래내역에서 취소여부가 "Y"가 아닌 것이 존재하지 않는 계좌를 추출
     => 제공해준 DATA에는 취소여부가 'Y'/'N' 만 존재하지만 다른 플래그의 존재가능성 고려하여 취소여부 != "Y" 를 조회 조건으로 추가
 
```

```
 API3. 연도별 관리점별 거래금액 합계를 구하고 합계금액이 큰 순서로 출력하는 API 개발.
    (취소여부가 ‘Y’ 거래는 취소된 거래임)

 ▶ Consideration
   - 거래내역 table과 계좌정보 table, 관리점정보 table join 필요
   - 취소된 거래는 거래로 보지 않는다. => 취소여부가 'Y'인 거래
   - 연도별, 관리지점별 거래금액의 합계를 구하기 위한 GROUP BY 필요 
   - 거래금액 합계가 큰 순서대로 SORT 
```

```
 API4. 분당점과 판교점을 통폐합하여 판교점으로 관리점 이관을 하였습니다. 지점명을 입력하면 해당지점의 거래금액 합계를 출력하는 API 개발
    (취소여부가 ‘Y’ 거래는 취소된 거래임)

 ▶ Consideration
   - 거래내역 table과 계좌정보 table, 관리점정보 table join 필요
   - 취소된 거래는 거래로 보지 않는다. => 취소여부가 'Y'인 거래
   - 통폐합된 판교점의 거래금액 합계를 출력하기 위해 계좌관리 테이블 내 "분당점"의 brCode를 "판교점"의 brCode로 치환한다.
     => "분당점"이 아닌 다른 관리점코드는 그대로 사용  
     => 판교점의 거래금액 합계 = 분당점의 거래금액합계 + 기존 판교점의 거래금액합계
   - 관리점별 거래금액의 합계를 구하기 위해 관리점코드로 GROUP BY 필요 
   - 관리점명을 INPUT PARAM으로 받는다. =>  #{brName}
   - 관리점명이 "분당점"인 경우, Exception 처리로 에러코드와 메세지 출력
     
```

## 빌드 및 실행방법

* 빌드 : IntelliJ에서 Maven을 사용하여 build 수행
* 초기데이터 적재 : Mysql을 설치하여 src/main/resources/database 폴더 내 database_info.sql을 수행하여 테이블 및 데이터를 생성한다.
* 환경 설정 정보 => src/main/resources/application.properties 내 정의
    - 서버 포트 : 9000
    - database : kakodb / id : lyan / pw : 1234 로 정의
* 실행 : "TransInfoController.java"를 실행한다.